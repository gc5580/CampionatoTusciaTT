<script>
// Percorso relativo
const csvUrl = "Classifica.csv"; 

fetch(csvUrl)
  .then(response => {
    if (!response.ok) {
        // Se non trova il file 
        throw new Error(`File non trovato (Status: ${response.status}).`);
    }
    return response.text();
  })
  .then(data => {
    // 1. Divide le righe per riga (gestendo sia \n che \r\n) e poi per punto e virgola (;)
    let rows = data.split(/\r?\n/).map(r => r.split(";")); 

    // 2. Filtra tutte le righe completamente vuote (quelle con solo ";;;;;...")
    rows = rows.filter(r => r.some(cell => cell.trim().length > 0));

    // Dati validi devono avere almeno un'intestazione e una riga di dati
    if (rows.length < 2) {
        document.getElementById("dataTable").innerHTML = "<caption>Nessun dato valido nel CSV o file troppo corto.</caption>";
        return;
    }
    
    // 3. L'intestazione (prima riga) inizia con una cella vuota, la ignoriamo.
    // Usiamo solo le intestazioni dalla seconda cella in poi (indice 1)
    const headers = rows[0].slice(1).map(h => h.trim()); 
    
    let html = "<thead><tr>";
    headers.forEach(h => { html += "<th>" + h + "</th>"; });
    html += "</tr></thead><tbody>";
    
    // 4. Scrive le righe di dati (dalla riga 1)
    for(let i=1; i<rows.length; i++){
      html += "<tr>";
      
      // Inizia dalla seconda cella della riga di dati (indice 1) per ignorare la colonna vuota iniziale
      const dataCells = rows[i].slice(1);
      
      // Scrive le celle fino a coprire tutte le intestazioni
      dataCells.forEach(cell => {
          html += "<td>" + cell.trim() + "</td>";
      });
      
      html += "</tr>";
    }
    html += "</tbody>";
    
    document.getElementById("dataTable").innerHTML = html;
  })
  .catch(err => {
    console.error("Errore caricamento CSV (Dettagli in Console):", err);
    document.getElementById("dataTable").innerHTML = `<caption>Errore nel caricamento dei dati: ${err.message}.</caption>`;
  });
</script>

</body>

</html>
